<wxs src="/pages/wxs/index.wxs" module="tools"></wxs>
<view class="box">
  <!-- 活动轮播 -->
  <banner class="mg-30" bannerId="{{bannerId}}"></banner>
  <!-- 头部洗车组件 -->
  <view class="item-box" wx:if="{{pageFlag==='wash'}}" bindtap="washTabBtn">
    <view class="item" data-type="{{item.goodsCategoryCode}}" wx:for="{{washBtnList}}" wx:key="goodsDefaultId">
      <image class="img stopTap" mode="widthFix" src="{{item.goodsCategoryIcon}}"></image>
      <text class="stopTap img-text{{activeTab==item.goodsCategoryCode?' active':''}}">{{item.goodsCategoryName}}</text>
    </view>
  </view>
  <!-- 筛选项区域 -->
  <view class="">
    <dropdown-menu active-color="#447fff" style="{{pageFlag==='maint'?'width: 66.6%;':'width: 75%;'}}">
      <view class="pos-info" bindtap="placeSearch" style="{{pageFlag==='maint'?'width: 33.3%;':'width: 25%;'}}">
        <iconfont size="40rpx" icon="position" color="#4D4D4D"></iconfont>
        <text class="address-name">
          <text hidden="{{currentPlace}}">正在获取位置</text>
          <text hidden="{{!currentPlace}}">{{currentPlace}}</text>
        </text>
      </view>
      <dropdown-item bind:change="selectBtn" model:value="{{ distance }}" options="{{ distanceOption }}" />
      <dropdown-item bind:change="selectBtn" model:value="{{ other }}" options="{{ otherOption }}">
      </dropdown-item>
      <dropdown-item bind:change="selectBtn" model:value="{{ carType }}" options="{{ carTypeOption }}" wx:if="{{pageFlag==='wash' && carTypeOption.length}}">
      </dropdown-item>
    </dropdown-menu>
  </view>
  <!-- 内容区域 -->
  <view class="content-box">
    <pull-refresh
      height="100%"
      model:count="{{total}}"
      model:hasMore="{{hasMore}}"
      bind:pullDown="initList"
      bind:reachBottom="upperList"
      model:isRefresh="{{collapse}}">
      <view class="card-item" wx:for="{{list}}" wx:key="goodsId">
        <view bindtap="goShopInfo" data-item="{{item}}">
          <business-card
            src="{{item.urlIcon}}"
            row1Title="{{item.orgName}}"
            row2Title="{{item.address}}"
            row2Suffix="{{item.distance}}km"
            lat="{{item.latitude}}"
            lng="{{item.longitude}}">
            <view slot="row3">
              <view class="flex-row" wx:if="{{item.orgTags.indexOf('activityCarWash') !== -1}}">
                <view style="padding-right:10rpx;">
                  <van-tag plain type="primary">一元洗车</van-tag>
                </view>
                <view style="padding-right:10rpx;" wx:for="{{item.orgTags}}" wx:key="item">
                  <van-tag plain  wx:if="{{item !== 'activityCarWash'}}">{{tagText[item]}}</van-tag>
                </view>
              </view>
            </view>
            <view slot="foot">
              <view class="foot-line">
                <view class="foot-left">
                  <view class="goods-desc">
                    <van-tag plain type="danger" wx:if="{{!tools.hasCurrentWeek(item.businessTimeList)}}">休息</van-tag>
                    <van-tag plain type="primary" wx:if="{{tools.hasCurrentWeek(item.businessTimeList)}}">服务</van-tag>
                    <text class="goods-name text-cut">{{item.orgGoodsExtList[0].goodsName || '-'}}</text>
                  </view>
                  <view class="goods-price">
                    <new-old-price wx:if="{{item.orgGoodsExtList[0].couponList.length}}" oldPrice="{{item.orgGoodsExtList[0].couponList[0].fixedAmount}}" newPrice="{{' ¥' + item.orgGoodsExtList[0].goodsMarketPrice}}"></new-old-price>
                    <new-old-price wx:else oldPrice="{{item.orgGoodsExtList[0].goodsPlatPrice}}" newPrice="{{'门市 ¥' + item.orgGoodsExtList[0].goodsMarketPrice}}"></new-old-price>
                  </view>
                </view>
                <view class="foot-right purchase-btn" data-cid="{{item.orgGoodsExtList[0].couponList[0].couponId}}" catchtap="openTip" wx:if="{{item.orgGoodsExtList[0].couponList.length}}">
                  <view class="right-now">立即抢</view>
                  <view class="remain-num">余{{item.orgGoodsExtList[0].couponList[0].numberDailyRemaining+''}}</view>
                </view>
              </view>
            </view>
          </business-card>
        </view>
      </view>
    </pull-refresh>
  </view>
</view>
<tip-dialog visible="{{tipVisible}}" bind:close="onConfirm"></tip-dialog>
